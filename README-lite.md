# BRCE FTP Lite - 轻量版

**专为录播姬用户设计的轻量级FTP解决方案**

## 🎯 **设计目标**

轻量版专门解决录播姬用户遇到的兼容性问题：
- ❌ **完整版**: 实时同步干扰录播，导致视频文件异常
- ✅ **轻量版**: 只读映射技术，完全避免录播干扰

## 🚀 **核心特性**

### 💎 **只读bind mount映射**
- 🔗 直接映射录播目录到FTP目录
- 📁 录制文件立即可见，无延迟
- 🛡️ 只读保护，FTP用户无法修改录播文件
- 💾 零系统资源消耗，无后台进程

### 🎮 **完全兼容录播姬**
- ✅ 无实时同步进程干扰
- ✅ 无文件锁冲突
- ✅ 无I/O资源竞争
- ✅ 录制过程完全不受影响

### 🔧 **简单易用**
- 一键安装部署
- 完整服务控制 (启动/停止/重启)
- 自动配置防火墙
- 自动开机挂载
- 基础用户管理
- 在线更新功能

## 📦 **快速开始**

### 安装使用
```bash
# 下载轻量版脚本
wget https://raw.githubusercontent.com/Sannylew/bilirec-ftp-sync/main/ftp-setup-lite.sh

# 运行脚本
sudo chmod +x ftp-setup-lite.sh
sudo ./ftp-setup-lite.sh
```

### 基本配置
- **映射方式**: 只读bind mount
- **默认目录**: `/root/brec/file` （录播姬默认路径）
- **默认用户**: `sunny`
- **FTP端口**: 21 + 40000-40100（被动模式）

## 🔧 **功能菜单**

```
====================================================
     🚀 BRCE FTP Lite 管理控制台 v1.0.0-lite
====================================================
1) 🚀 安装/配置FTP服务 (只读映射)
2) 📊 查看服务状态
3) ▶️ 启动FTP服务
4) ⏹️ 停止FTP服务
5) 🔄 重启FTP服务
6) 👥 用户管理 (添加/删除/改密码)
7) 🔄 在线更新脚本
8) 🗑️ 卸载FTP服务
0) 🚪 退出
```

## 📁 **目录结构**

### 🎯 **用户家目录映射方式**
```
源目录（录播姬）:
/root/brec/file/
├── 房间1/
├── 房间2/
└── video.mp4

用户家目录设置:
/home/username/ftp/       # 用户家目录指向此处
├── 房间1/                # bind mount读写映射录播文件
├── 房间2/                # bind mount读写映射录播文件  
└── video.mp4             # bind mount读写映射录播文件

FTP用户登录后:
/                         # 用户看到的根目录（实际是/home/username/ftp）
├── 房间1/                # 可以读写删除的源目录内容
├── 房间2/                # 可以读写删除的源目录内容
└── video.mp4             # 可以读写删除的源目录内容
```

**核心原理**: 通过设置用户家目录为`/home/username/ftp`，并使用读写bind mount将源目录映射到该位置，用户登录后可以完整操作录播文件。

## 💡 **技术实现**

### 🎯 **用户家目录 + bind mount 配置**
```bash
# 1. 创建用户和目录结构
useradd -m -s /bin/bash username           # 创建标准用户
mkdir -p /home/username/ftp               # 创建FTP目录
usermod -d /home/username/ftp username    # 设置家目录为ftp目录

# 2. 创建读写bind mount映射
mount --bind /root/brec/file /home/username/ftp

# 3. 设置权限
chmod 755 /root/brec/file                 # 确保源目录可访问
chgrp ftp-users /root/brec/file           # 设置用户组
chmod g+w /root/brec/file                 # 添加写权限

# 4. 开机自动挂载
echo "/root/brec/file /home/username/ftp none bind 0 0" >> /etc/fstab

# 5. vsftpd.conf 配置
chroot_local_user=YES         # 限制用户在家目录内
write_enable=YES              # 启用写入
delete_enable=YES             # 启用删除
```

### 🛡️ 权限设置
- **FTP用户**: 完整权限，可以读取、写入、删除文件
- **录播文件**: 保持原始权限，通过映射提供访问
- **目录映射**: 读写访问，支持文件管理操作

## 🆚 **版本对比**

| 功能特性 | 完整版 (ftp-setup.sh) | 轻量版 (ftp-setup-lite.sh) |
|---------|----------------------|---------------------------|
| **录播兼容性** | ⚠️ 可能干扰录播 | ✅ 完全兼容 |
| **资源消耗** | 📊 后台同步进程 | 💾 零消耗 |
| **实时性** | 🚀 实时同步 | 🚀 实时映射 |
| **双向同步** | ✅ 支持 | ❌ 只读 |
| **用户上传** | ✅ 支持 | ✅ 支持 |
| **文件修改** | ✅ 支持 | ✅ 支持 |
| **文件删除** | ✅ 支持 | ✅ 支持 |
| **在线更新** | ✅ 智能更新+强制更新 | ✅ 智能更新+强制更新 |
| **服务控制** | ✅ 完整控制 | ✅ 完整控制 |
| **日志管理** | ✅ 完整功能 | ❌ 基础功能 |
| **适用场景** | 高级用户、复杂需求 | 录播用户、简单分享 |

## 🎯 **适用场景**

### ✅ **推荐使用轻量版**
- 主要需求是**分享录播文件**
- 使用**录播姬等录制软件**
- 希望**零干扰录制过程**
- 不需要FTP用户上传功能
- 追求**简单稳定**

### ⚠️ **建议使用完整版**
- 需要**双向文件同步**
- FTP用户需要**上传文件**
- 需要**高级日志管理**
- 不使用录制软件
- 可以接受资源消耗

## 🚨 **重要说明**

### 🔒 **安全特性**
- **只读映射**: FTP用户无法修改、删除录播文件
- **权限隔离**: 每个FTP用户独立权限
- **源文件保护**: 录播文件完全受保护

### ⚠️ **使用限制**
- **只读访问**: FTP用户只能下载，不能上传
- **无双向同步**: 不支持FTP到源目录的同步
- **基础管理**: 功能相对简单

### 🔄 **更新功能**

轻量版支持在线更新，保持最新功能和修复：

```bash
# 在脚本菜单中选择
5) 🔄 在线更新脚本

# 更新选项
1) 🔍 检查更新 (智能更新) - 仅在有差异时更新
2) ⚡ 强制更新 (直接覆盖) - 无条件更新到最新版本
```

**更新特性:**
- ✅ 智能版本对比
- ✅ 内容差异检测  
- ✅ 自动备份当前版本
- ✅ 语法验证保护
- ✅ 一键重启功能

### 🎮 **服务控制**

轻量版提供完整的FTP服务控制功能：

```bash
# 启动FTP服务
3) ▶️ 启动FTP服务
- 自动检查服务状态
- 智能启用开机自启
- 显示连接信息和用户数
- 提供详细的服务信息

# 停止FTP服务  
4) ⏹️ 停止FTP服务
- 检测活跃连接数
- 确认提示避免误操作
- 可选禁用开机自启
- 安全停止所有连接

# 重启FTP服务
5) 🔄 重启FTP服务
- 快速重启vsftpd服务
- 自动验证重启状态
```

**控制特性:**
- ✅ 智能状态检测
- ✅ 安全确认机制
- ✅ 详细状态信息
- ✅ 开机自启管理
- ✅ 连接数监控

### 🎯 **家目录映射优势**

**完美的用户体验**：
- ✅ 登录后立即看到录播文件
- ✅ 无需进入任何子目录  
- ✅ FTP根目录显示源目录内容
- ✅ 路径简洁，操作直观

**技术优势**：
- ✅ 使用标准的bind mount，稳定可靠
- ✅ 用户隔离，每个用户有独立的ftp目录
- ✅ 支持不同用户映射不同源目录
- ✅ 权限管理清晰，安全性高

### 💡 **最佳实践**
- 录播期间无需任何特殊操作
- 录制文件立即在FTP根目录显示
- 用户登录后可以完整管理录播文件
- 可以直接通过FTP删除、重命名、整理文件
- 可随时启动/停止服务而不影响录播
- 建议定期检查更新获得最新修复
- 可通过FTP直接清理旧录播文件
- 可配合自动化脚本管理

## 📞 **技术支持**

- **GitHub Issues**: [提交问题](https://github.com/Sannylew/bilirec-ftp-sync/issues)
- **完整版文档**: [README.md](README.md)
- **项目仓库**: [bilirec-ftp-sync](https://github.com/Sannylew/bilirec-ftp-sync)

## 📜 **许可证**

本项目采用 MIT 许可证 - 查看 [LICENSE](LICENSE) 文件了解详情。

---

**轻量版 - 专为录播姬用户打造的零干扰FTP解决方案！** 🎉
